<view class="container">
    <scroll-view scroll-y class="dashboard">
        <wxs module="styleHelper">
            var getStyleClass = function(tag) {
                // 定义汉字到英文风格的映射
                var map = {
                '狠': 'red', '爆': 'red', '燃': 'red', '莽': 'red',
                '准': 'blue', '巧': 'blue', '力': 'blue',
                '六': 'purple', '混': 'purple', '牢': 'purple',
                '富': 'gold', '浪': 'gold',
                '凡': 'silver', '新': 'silver'
                };
                // 如果找不到，默认返回 silver
                return map[tag] || 'silver';
            }
            module.exports.getStyleClass = getStyleClass;
        </wxs>
        <view class="profile-card">
            <view class="playtime-tag">
                <text class="label">游戏时长</text>
                <text class="value">{{ userData.timePlayed }}h</text>
            </view>
            <view class="style-badge style-{{styleHelper.getStyleClass(userData.style_tag)}}">
                <text class="style-label">STYLE</text>
                <view class="style-char-box">
                    <text class="style-char">{{ userData.style_tag || '凡' }}</text>
                </view>
            </view>
            <view class="profile-info">
                <image class="avatar" src="{{ userData.avatar }}" mode="aspectFill"></image>
                <view class="text-group">
                    <text class="nickname">{{ userData.nickname }}</text>
                    <view class="level-badge">
                        <text>ID: {{ userInfo.steam_id || '---' }}</text>
                    </view>
                </view>
            </view>
        </view>
        <view class="stats-grid">
            <view class="stat-box">
                <text class="stat-label">Avg K/D (30d)</text>
                <view class="stat-value {{ userData.kd >= 1.2 ? 'gold' : '' }}">
                    {{ userData.kd }}
                </view>
            </view>
            <view class="stat-box">
                <text class="stat-label">★StarTrack™️</text>
                <text class="stat-value">{{ userData.totalKills }}</text>
            </view>
            <view class="stat-box">
                <text class="stat-label">ADR</text>
                <text class="stat-value">{{ userData.adr }}</text>
            </view>
            <view class="stat-box">
                <text class="stat-label">Win Rate</text>
                <text class="stat-value">{{ userData.winRate }}</text>
            </view>
        </view>
        <view class="section-title">能力模型 (Capability)</view>
        <view class="chart-container radar-container">
            <canvas type="2d" id="radarCanvas" class="radar-canvas"></canvas>
        </view>
        <view class="section-title">近期状态 (KD Trend)</view>
        <view class="chart-container">
            <canvas type="2d" id="trendCanvas" style="width: 100%; height: 100%;" bindtouchstart="onTouchChartStart" bindtouchmove="onTouchChartMove" bindtouchend="onTouchChartEnd"></canvas>
        </view>
        <view style="text-align: center; color: #666; font-size: 20rpx; margin-top: -20rpx; margin-bottom: 30rpx;">
            ← 左右滑动查看历史 · 点击查看详情 →
        </view>
        <view class="section-title">每日战报 (Daily Log)</view>
        <view class="match-list">
            <block wx:for="{{ matchHistory }}" wx:key="date">
                <view class="match-item">
                    <view class="match-left">
                        <view class="map-tag">{{ item.date }}</view>
                        <text class="sub-label">{{ item.rounds }} Rnds</text>
                    </view>
                    <view class="match-center-main">
                        <text class="score">{{ item.score }}</text>
                        <view class="tag-row">
                            <view class="kd-tag {{ item.Rating >= 1.0 ? 'pos' : 'neg' }}">
                                {{ item.Rating }} Rating
                            </view>
                        </view>
                    </view>
                    <view class="match-right-grid">
                        <view class="grid-row">
                            <text class="stat-mini">
                                ADR:
                                <text class="val">{{ item.adr }}</text>
                            </text>
                            <text class="stat-mini">
                                MVP:
                                <text class="val gold">{{ item.mvp }}</text>
                            </text>
                        </view>
                        <view class="grid-row">
                            <text class="stat-mini">
                                HS%:
                                <text class="val">{{ item.hsr }}%</text>
                            </text>
                            <text class="stat-mini">
                                DMG:
                                <text class="val">{{ item.dmg }}</text>
                            </text>
                        </view>
                    </view>
                </view>
            </block>
            <view wx:if="{{matchHistory.length === 0}}" style="text-align:center; color:#666; padding:20rpx;">
                暂无比赛记录
            </view>
        </view>
    </scroll-view>
</view>