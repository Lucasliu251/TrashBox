<navigation-bar title="每日排行榜" back="{{true}}" color="white" background="#1e1e1e"></navigation-bar>
<view class="container">
    <view class="toolbar-header">
  
        <picker mode="date" value="{{currentDate}}" start="2023-01-01" end="{{maxDate}}" bindchange="bindDateChange">
            <view class="date-picker-wrap">
            <text class="date-text">📅 {{currentDate}}</text>
            <text class="picker-arrow">▼</text>
            </view>
        </picker>

        <view class="subscribe-capsule" bindtap="onToggleSubscribe">
            <text class="sub-label"> 日报订阅</text>
            <view class="toggle-switch {{ isSubscribed ? 'active' : '' }}">
            <view class="toggle-knob"></view>
        </view>
  </view>

</view>
    <view class="list-header">
        <text class="th-rank">排名</text>
        <text class="th-player">玩家</text>
        <text class="th-data">数据 (KD/ADR)</text>
    </view>
    <scroll-view scroll-y class="rank-list">
        <block wx:for="{{ rankings }}" wx:key="steam_id">
            <navigator url="/pages/statsVis/statsVis?steamid={{item.steam_id}}" class="rank-item">
                <view class="item-left">
                    <view class="rank-num rank-{{item.rank <= 3 ? item.rank : 'common'}}">
                        {{item.rank}}
                    </view>
                    <image class="avatar" src="{{item.avatar}}" mode="aspectFill"></image>
                    <view class="info">
                        <text class="nickname">{{item.nickname || 'Unknown'}}</text>
                        <view class="tags" wx:if="{{item.daily_mvp > 0}}">
                            <text class="tag-mvp">★ {{item.daily_mvp}} MVPs</text>
                        </view>
                    </view>
                </view>
                <view class="item-right">
                    <view class="stat-main">
                        <text class="val {{ item.rating >= 1.2 ? 'gold' : '' }}">
                            {{ item.rating }}
                        </text>
                        <text class="label">Rating</text>
                    </view>
                    <view class="stat-sub">
                        <text class="val">{{ item.adr }}</text>
                        <text class="label">ADR</text>
                    </view>
                </view>
            </navigator>
        </block>
        <view wx:if="{{rankings.length === 0}}" class="empty-state">
            <image src="/assets/icons/cs-logo-grey.avif" mode="widthFix" style="width:100rpx; opacity:0.3;"></image>
            <text>该日期暂无比赛数据</text>
        </view>
    </scroll-view>
</view>
<page-container show="{{showSubscribeModal}}" round position="center" custom-style="width: 80%; border-radius: 16rpx; padding: 40rpx;">
    <view style="text-align: center;">
        <view style="font-size: 36rpx; font-weight: bold; margin-bottom: 20rpx;">开启每日战报提醒</view>
        <view style="font-size: 28rpx; color: #666; margin-bottom: 40rpx;">
            订阅后，每天23:30榜单更新时，您将在微信收到最新的排名和KD数据推送。
        </view>
        <button type="primary" bindtap="onSubscribeBtnClick">立即开启</button>
        <view bindtap="closeSubscribeModal" style="margin-top: 20rpx; color: #999; font-size: 24rpx;">暂不需要</view>
    </view>
</page-container>